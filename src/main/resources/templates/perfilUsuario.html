<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<title>Perfil</title>

	<script th:src="@{/js/simple-datatables-2.1.10.min.js}"></script>
    <link th:href="@{/css/simple-datatables-2.1.10.css}" rel="stylesheet">
	<link rel="stylesheet" th:href="@{/css/perfilUsuario.css}" href="css/perfilUsuario.css" type="text/css" />
</head>

<body>
	<th:block th:replace="fragments/head :: header" />
	<nav th:replace="fragments/nav.html :: nav">
		Nav goes here
	</nav>

	<div class="container">
		<div class="main">

			<div th:if="(${session.u.id} eq ${user.id}) or ${session.u.hasRole('ADMIN')}">
				<div class="botonesNegocio">
					<p class="titulo">Informaci칩n del usuario <span th:text="${user.username}">Pepe</span></p>
					
					<div class="enlacesNegocio">
						<a th:href="@{/user/{id}/editar(id=${session.u.id})}">Editar Perfil</a>
					</div>
				</div>
				
				<img th:src="@{/user/{id}/photo(id=${user.id})}" width="60px" height="60px">
				<p><span class="titulo2">Nombre de usuario:</span><span th:text="${user.firstName}">x</span></p>
				<p><span class="titulo2">Primer apellido:</span><span th:text="${user.lastName1}">x</span></p>
				<p><span class="titulo2">Segundo apellido:</span><span th:text="${user.lastName2}">x</span></p>
				<p><span class="titulo2">Edad:</span><span th:text="${user.age}">x</span></p>
				<p><span class="titulo2">Tel칠fono:</span><span th:text="${user.tlf}">x</span></p>
				<p><span class="titulo2">Direcci칩n:</span><span th:text="${user.address}">x</span></p>
				<p><span class="titulo2">Ciudad:</span><span th:text="${user.city}">x</span></p>
				<p><span class="titulo2">Provincia:</span><span th:text="${user.province}">x</span></p>
				<p><span class="titulo2">C칩digo Postal:</span><span th:text="${user.postalCode}">x</span></p>

				<h2>Negocios</h2>
				<table>
					<tr>
						<th>Nombre</th>
						<th>Eliminar</th>
					</tr>
					<tr th:each="n: ${negocios}" th:id="'neg_' + ${n.id}">						
						<td><a th:href="@{/negocio/{id}(id=${n.id})}" th:text="${n.nombre}">123</a></td>
						<td>
							<form method="post" th:action="@{/negocio/{id}/eliminar(id=${n.id})}">
								<button th:id="'negocio_' + ${n.id}" th:text="Eliminar" type="submit">游딈</button>
							</form><!--'negocio_' + ${n.id}-->
						</td>
					</tr>
				</table>

				<h2>Reservas</h2>
				<div th:each="r: ${reservas}">
					<p th:if="${r.estado.name() == 'SOLICITADA'}">
						<span th:text="${r.id}">123</span>
						<span th:text="${r}">Texto de la reserva</span>
						<div th:if="${r.estado.name() == 'SOLICITADA'}">
							<form method="post" th:action="@{/reserva/{id}/cancelar(id=${r.id})}">
								<button th:text="Cancelar" type="submit">游딈</button>
							</form>
							 
						</div>
					</p>
				</div>

				<a id="newNegocio" th:href="@{/negocio/}">Crea tu negocio</a>

				<form method="post" th:action="@{/user/{id}/eliminar(id=${session.u.id})}">
					<button type="submit">Eliminar cuenta</button>
				</form>

			</div>
		</div>
	</div>

	<script>

		// env칤o de mensajes v칤a AJAX, sin recargar la p치gina
		document.addEventListener("DOMContentLoaded", () => {
			let b = document.getElementById("negocio_3");
			b.onclick = (e) => {
				//let idOfTarget = +document.getElementById("idOfTarget").value;
				//let idOfTarget = +b.dataset.id;
				//let url = b.parentNode.action.replace("idOfTarget", 3);
				let url = b.parentNode.action;

				e.preventDefault();
				console.log(b, b.parentNode)
				go(url, 'POST')
					.then(d => {
						console.log("happy");
						document.getElementById("neg_3").remove();
					})
			}
		});

		//document.getElementById("#tablanegocios").removeChild(document.getElementById("#n"+id))

		//document.getElementById("#n"+id).remove()
	
	</script>
	<th:block th:replace="fragments/footer.html" />
</body>

</html>