<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<title>Admin</title>
	<link rel="stylesheet" th:href="@{/css/admin.css}" href="css/admin.css" type="text/css" />


</head>

<body>
	<th:block th:replace="fragments/head :: header" />
	<nav th:replace="fragments/nav.html :: nav">
		Nav goes here
	</nav>

	<div class="container">
		<div class="main">
			<h1 th:text="#{admin.welcome}">Ojo solo admines</h1>

			<!-- <h4>ConfiguraciÃ³n</h4>
	
		<ul>
			<li>Directorio local para archivos de usuario: <span th:text="${basePath}">tal</span>
			<li>Perfiles activos: <span th:each="a: ${activeProfiles}" th:text="${a}">tal</span>
			<li>Consola h2: 
				<a th:href="@{/h2}" th:if="${debug} == 'true'">habilitada</a>
				<span th:unless="${debug} == 'true'">no habilitada</span>
			</li>
		</ul> -->

			<h4>Usuarios (ğŸ‘¤)</h4>

			<table class="adminTable">
				<tr>
					<th>Nombre & Enlace</th>
					<th>Deshabilitar (ğŸ”’) Ã³ Habilitar (ğŸ”“)</th>
				<tr th:each="u: ${users}">
					<td><a th:href="@{/user/{id}(id=${u.id})}" th:text="${u.username}">Pepe</a></td>
					<td>
						<form method="post" th:action="@{/admin/toggleuser(id=${u.id})}">
							<button th:text="${u.enabled eq 1 ? 'ğŸ”“ â†’ ğŸ”’' : 'ğŸ”’ â†’ ğŸ”“'}" type="submit">ğŸ—‘</button>
						</form>
					</td>
				</tr>
			</table>


			<h4>Negocios (ğŸª)</h4>

			<table class="adminTable">
				<tr>
					<th>Negocio</th>
					<th>Habilitar/Deshabilitar</th>
					<th>Eliminar (ğŸ—‘)</th>
				</tr>
						
				<tr th:each="n: ${negocios}" th:id="'negAdmin_' + ${n.id}">
					<td><a th:href="@{/negocio/{id}(id=${n.id})}" th:text="${n.nombre}">X</a></td>
					<td>
						<form method="post" th:action="@{/admin/toggleBusiness(id=${n.id})}">
							<button th:text="${n.enabled eq 1 ? 'ğŸ”“ â†’ ğŸ”’' : 'ğŸ”’ â†’ ğŸ”“'}" type="submit">ğŸ—‘</button>
						</form>
					</td>
					<td>

						<form method="post" class="elimina_negocioAdmin" th:data-id="'negAdmin_' + ${n.id}" th:action="@{/negocio/{id}/eliminar(id=${n.id})}">
							<button type="submit">Eliminar</button>
						</form>
						<!--'negocio_' + ${n.id}-->

					</td>
				</tr>
			</table>

		</div>
	</div>

	<script>

        // envÃ­o de mensajes vÃ­a AJAX, sin recargar la pÃ¡gina
        document.addEventListener("DOMContentLoaded", () => {
            let bs = document.querySelectorAll(".elimina_negocioAdmin");
            for (let b of bs) {
                b.onclick = (e) => {
                    let idOfTarget = b.dataset.id;
                    let url = b.action;
                    console.log("he pillado el evento", b, idOfTarget, url);

                    e.preventDefault();
                    console.log(b, b.parentNode)
                    go(url, 'POST')
                        .then(d => {
                            console.log("happy", idOfTarget, d.id);
                            document.getElementById(idOfTarget).remove();
                        })
                }
            }
        });

        //document.getElementById("#tablanegocios").removeChild(document.getElementById("#n"+id))

        //document.getElementById("#n"+id).remove()
    </script>

	<footer th:replace="fragments/footer.html :: footer">
		Footer goes here
	</footer>
</body>

</html>